@extends('layouts.main')

@section('content')
<div class="page-content">
    <!--breadcrumb-->
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
        <div class="breadcrumb-title pe-3"><a href="/shared/home"><i class="bx bx-home-alt"></i></a></div>
        <div class="ps-3">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 p-0">
                    <li class="breadcrumb-item active" aria-current="page">Epret</li>
                    <li class="breadcrumb-item active" aria-current="page">Simulateur</li>
                </ol>
            </nav>
        </div>
        <div class="ms-auto">
            <div class="btn-group">

            </div>
        </div>
    </div>
    <!--end breadcrumb-->
  
    <div class="container mt-5">
        <h3 class="text-center text-uppercase">Simulateur de Prêt</h3>
        <div class="row mt-5">
            <!-- Formulaire -->
            <div class="col-8">
                <div class="card container">
                    <div class="card-header text-center">
                        <h5 class="text-uppercase">INFORMATIONS SUR LE PRÊT </h5>
                    </div>
                    <div class="card-body">
                        <form id="loanSimulatorForm" class="row g-3 needs-validation" novalidate>
                            <!-- Genre -->
                            <div class="col-md-6">
                                <label for="genre" class="form-label">Genre <span class="text-danger">*</span></label>
                                <select id="genre" class="form-select" required>
                                    <option value="" disabled selected>Choisir...</option>
                                    <option value="femme">Femme</option>
                                    <option value="homme">Homme</option>
                                </select>
                                <div class="invalid-feedback">Veuillez sélectionner votre genre.</div>
                            </div>
            
                            <!-- Date de naissance -->
                            <div class="col-md-6">
                                <label for="birthday" class="form-label">Date de naissance <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="birthday" required>
                                <div class="invalid-feedback">Veuillez saisir votre date de naissance.</div>
                            </div>
            
                            <!-- Montant du prêt -->
                            <div class="col-md-6">
                                <label for="loanMontant" class="form-label">Montant du prêt (en FCFA) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="loanMontant" placeholder="Entrez le montant" required>
                                <div class="invalid-feedback">Veuillez entrer un montant valide.</div>
                            </div>
            
                            <!-- Durée -->
                            <div class="col-md-6">
                                <label for="loanDuration" class="form-label">Durée (en mois) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="loanDuration" placeholder="Entrez la durée" required>
                                <div class="invalid-feedback">Veuillez entrer une durée valide.</div>
                            </div>
            
                            <!-- Poids et Taille -->
                            <div class="col-md-6">
                                <label for="poids" class="form-label">Poids (kg) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="poids" placeholder="Entrez votre poids" required>
                                <div class="invalid-feedback">Veuillez entrer votre poids.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="taille" class="form-label">Taille (cm) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="taille" placeholder="Entrez votre taille" required>
                                <div class="invalid-feedback">Veuillez entrer votre taille.</div>
                            </div>
            
                            <!-- Garantie Yako -->
                            <div class="col-12 form-check">
                                <input class="form-check-input" type="checkbox" id="disableYako">
                                <label class="form-check-label" for="disableYako">Désactiver la garantie Yako</label>
                            </div>
            
                            <!-- Boutons -->
                            <div class="col-12 d-flex justify-content-between align-items-center">
                                <button type="submit" class="btn btn-primary text-uppercase">Évaluer la Prime</button>
                                <a href="{{ route('epret.create')}}" class="btn btn-outline-primary text-uppercase">Démarrer une Souscription</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Résultats -->
            <div class="col-4">
                <div class="card">
                    <div class="card-header text-center">
                        <h5 class="text-uppercase">Résultat du simulateur</h5>
                    </div>
                    <div class="card-body">
                        <div class="result-container">
                            <div id="resultat"></div>

                            {{-- <div class="card mb-3">
                                <div class="card-body" style="background-color: #fff1eb">
                                    <h5 class="card-title">Prime couverture de prêt :</h5>
                                    <p class="card-text fs-4"><span id="loanCoverage" class="font-weight-bold">0</span> Fcfa</p>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-body" style="background-color: #fff1eb">
                                    <h6 class="card-title">Prime de risque emprunteur PAMF CI :</h6>
                                    <p class="card-text fs-4"><span id="pamfRisk" class="font-weight-bold">0</span> Fcfa</p>
                                </div>
                            </div> --}}

                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Garantie Yako :</h5>
                                    <p class="card-text fs-4"><span id="yakoGuarantee" class="font-weight-bold">0</span> Fcfa</p>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-body" style="background-color: #c8e6c9">
                                    <h5 class="card-title">Total des primes :</h5>
                                    <p class="card-text float-end fs-3"><span id="totalPremium" class="font-weight-bold">0</span> Fcfa</p>
                                </div>
                            </div>
                        </div>
                    </div> 
                </div>             
            </div>
        </div>
    </div>

    <script>
        document.getElementById("loanSimulatorForm").addEventListener("submit", function(event) {
            event.preventDefault();

            // Récupérer la date de naissance saisie par l'utilisateur
            const birthdayInput = document.getElementById('birthday');
            const birthday = new Date(birthdayInput.value);
            // Récupérer la date actuelle
            const today = new Date();
            // Calculer l'âge en années
            const age = today.getFullYear() - birthday.getFullYear();

           
            // Récupération des données du formulaire
            // const age = parseInt(document.getElementById("age").value);
            const duree = parseInt(document.getElementById("loanDuration").value);
            const montant = parseFloat(document.getElementById("loanMontant").value);
            const genre = document.getElementById("genre").value;
            const poids = parseFloat(document.getElementById("poids").value);
            const taille = parseFloat(document.getElementById("taille").value);

            // Validation des âges non pris en charge
            if (age > 61) {
                document.getElementById("resultat").innerText = "Veuillez contacter Yako Africa.";
                return;
            }

            if (duree > 36) {
                document.getElementById("resultat").innerText = "Veuillez contacter Yako Africa.";
                return;
            }

            // Calcul du poids corrigé (PC)
            let poidsCorrige = poids;
            if (genre === "femme" && age < 25) {
                poidsCorrige += 6;
            } else if (genre === "homme" && age < 25) {
                poidsCorrige += 4;
            }

            // Calcul du rapport poids/taille (RPT)
            const rpt = parseFloat(((poidsCorrige / (taille - 100)) - 1).toFixed(2));

            // Déduction de l'indice de surmortalité à partir du tableau
            let indiceSurmortalite = 0;
            if (rpt <= -0.5 || rpt >= 0.8) {
                document.getElementById("resultat").innerText = "Veuillez contacter la LOYALE VIE.";
                return;
            } else if (rpt >= -0.49 && rpt <= -0.25) {
                indiceSurmortalite = 50;
            } else if (rpt >= -0.24 && rpt <= 0.24) {
                indiceSurmortalite = 0;
            } else if (rpt >= 0.25 && rpt <= 0.39) {
                indiceSurmortalite = 25;
            } else if (rpt >= 0.4 && rpt <= 0.49) {
                indiceSurmortalite = 50;
            } else if (rpt >= 0.5 && rpt <= 0.59) {
                indiceSurmortalite = 75;
            } else if (rpt >= 0.6 && rpt <= 0.69) {
                indiceSurmortalite = 100;
            } else if (rpt >= 0.7 && rpt <= 0.79) {
                indiceSurmortalite = 150;
            }

            // Déduction du taux de conversion en fonction de l'âge saisi
            let tauxConversion = 0;
            if (age < 40) {
                tauxConversion = 30;
            } else if (age >= 40 && age <= 44) {
                tauxConversion = 35;
            } else if (age >= 45 && age <= 49) {
                tauxConversion = 35;
            } else if (age >= 50 && age <= 54) {
                tauxConversion = 40;
            } else if (age >= 55 && age <= 59) {
                tauxConversion = 45;
            } else if (age >= 60 && age <= 64) {
                tauxConversion = 65;
            } else if (age >= 65 && age <= 69) {
                tauxConversion = 65;
            } else if (age >= 70 && age <= 74) {
                tauxConversion = 80;
            }

            // Calcul du taux de surprime
            const tauxSurprime = (tauxConversion / 100) * (indiceSurmortalite / 100);

            // Calcul de la garantie décès
            let tauxPrime = 0;
            if (duree >= 1 && duree <= 12) {
                tauxPrime = 0.009;
            } else if (duree >= 13 && duree <= 24) {
                tauxPrime = 0.012;
            } else if (duree >= 25 && duree <= 36) {
                tauxPrime = 0.0195;
            }

            const garantieDeces = montant * tauxPrime;

            // Calcul de la prime
            const prime = garantieDeces * (1 + tauxSurprime);

            // Résultat final
            const disableYako = document.getElementById('disableYako').checked;
            const yakoGuaranteeAmount = garantieDeces;
            const yakoGuarantee = disableYako ? 0 : yakoGuaranteeAmount;
            document.getElementById('yakoGuarantee').innerText = yakoGuarantee;


            // Résultat final
            document.getElementById("resultat").innerHTML = `

                <p>Poids corrigé: ${poidsCorrige} kg</p>
                <p>RPT: ${rpt}</p>
                <p>Surmortalité: ${indiceSurmortalite}%</p>
                <p>Garantie Décès : ${garantieDeces.toFixed(2)} Fcfa</p>
                <p>Taux Surprime : ${(tauxSurprime * 100).toFixed(2)} %</p>
                <p>Prime totale : ${prime.toFixed(2)} Fcfa</p>
            `;
        });
    </script>

</div>
@endsection

{{-- <div class="row">
    <div class="col-4">
        <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="prestConsommation" name="typepret" value="consommation">
            <label class="form-check-label" for="prestConsommation">
                Prêt à la consommation
            </label>
        </div>
    </div>
    <div class="col-4">
        <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="avanceTresorerie" name="typepret" value="tresorerie">
            <label class="form-check-label" for="avanceTresorerie">
                Avance de trésorerie
            </label>
        </div>
    </div>
    <div class="col-4">
        <div class="form-check mb-3">
            <input class="form-check-input" type="radio" id="prestImobilier" name="typepret" value="imobilier">
            <label class="form-check-label" for="prestImobilier">
                Prêt immobilier
            </label>
        </div>
    </div>
</div> --}}






{{-- <script>
    document.getElementById("loanSimulatorForm").addEventListener("submit", function(event) {
        event.preventDefault();

        // Récupérer la date de naissance saisie par l'utilisateur
        const birthdayInput = document.getElementById('birthday');
        const birthday = new Date(birthdayInput.value);
        // Récupérer la date actuelle
        const today = new Date();
        // Calculer l'âge en années
        const age = today.getFullYear() - birthday.getFullYear();

       
        // Récupération des données du formulaire
        // const age = parseInt(document.getElementById("age").value);
        const duree = parseInt(document.getElementById("loanDuration").value);
        const montant = parseFloat(document.getElementById("loanMontant").value);
        const genre = document.getElementById("genre").value;
        const poids = parseFloat(document.getElementById("poids").value);
        const taille = parseFloat(document.getElementById("taille").value);

        // Validation des âges non pris en charge
        if (age > 61) {
            document.getElementById("resultat").innerText = "Veuillez contacter Yako Africa.";
            return;
        }

        if (duree > 36) {
            document.getElementById("resultat").innerText = "Veuillez contacter Yako Africa.";
            return;
        }

        // Calcul du poids corrigé (PC)
        let poidsCorrige = poids;
        if (genre === "femme" && age < 25) {
            poidsCorrige += 6;
        } else if (genre === "homme" && age < 25) {
            poidsCorrige += 4;
        }

        // Calcul du rapport poids/taille (RPT)
        const rpt = parseFloat(((poidsCorrige / (taille - 100)) - 1).toFixed(2));

        // Déduction de l'indice de surmortalité à partir du tableau
        let indiceSurmortalite = 0;
        if (rpt <= -0.5 || rpt >= 0.8) {
            document.getElementById("resultat").innerText = "Veuillez contacter la LOYALE VIE.";
            return;
        } else if (rpt >= -0.49 && rpt <= -0.25) {
            indiceSurmortalite = 50;
        } else if (rpt >= -0.24 && rpt <= 0.24) {
            indiceSurmortalite = 0;
        } else if (rpt >= 0.25 && rpt <= 0.39) {
            indiceSurmortalite = 25;
        } else if (rpt >= 0.4 && rpt <= 0.49) {
            indiceSurmortalite = 50;
        } else if (rpt >= 0.5 && rpt <= 0.59) {
            indiceSurmortalite = 75;
        } else if (rpt >= 0.6 && rpt <= 0.69) {
            indiceSurmortalite = 100;
        } else if (rpt >= 0.7 && rpt <= 0.79) {
            indiceSurmortalite = 150;
        }

        // Déduction du taux de conversion en fonction de l'âge saisi
        let tauxConversion = 0;
        if (age < 40) {
            tauxConversion = 30;
        } else if (age >= 40 && age <= 44) {
            tauxConversion = 35;
        } else if (age >= 45 && age <= 49) {
            tauxConversion = 35;
        } else if (age >= 50 && age <= 54) {
            tauxConversion = 40;
        } else if (age >= 55 && age <= 59) {
            tauxConversion = 45;
        } else if (age >= 60 && age <= 64) {
            tauxConversion = 65;
        } else if (age >= 65 && age <= 69) {
            tauxConversion = 65;
        } else if (age >= 70 && age <= 74) {
            tauxConversion = 80;
        }

        // Calcul du taux de surprime
        const tauxSurprime = (tauxConversion / 100) * (indiceSurmortalite / 100);

        // Calcul de la garantie décès
        let tauxPrime = 0;
        if (duree >= 1 && duree <= 12) {
            tauxPrime = 0.009;
        } else if (duree >= 13 && duree <= 24) {
            tauxPrime = 0.012;
        } else if (duree >= 25 && duree <= 36) {
            tauxPrime = 0.0195;
        }

        // garantie deces optionel
        const garantieDeces = montant * tauxPrime;


        // calculte de prime obseque
        
        let primeObseque = 0;
        if (age >= 18 && age <= 55) {
            primeObseque = 5000;
        } else if (age >= 56 && age <= 65) {
            primeObseque = 12700;
        }
        document.getElementById('primeObseque').innerText = primeObseque.toFixed(2);


        // Calcul de la prime emprunteur
        const primeEmprunteur = tauxPrime * montant;
        document.getElementById('primeEmprunteur').innerText = primeEmprunteur.toFixed(2);

        // Calcul de la prime
        const prime = garantieDeces * (1 + tauxSurprime);
        

        // Résultat final
        const disableYako = document.getElementById('disableYako').checked;
        const yakoGuaranteeAmount = garantieDeces;
        const yakoGuarantee = disableYako ? 0 : yakoGuaranteeAmount;
        document.getElementById('yakoGuarantee').innerText = yakoGuarantee;
        

        const primeFinal = prime + yakoGuarantee + primeObseque;
        

        document.getElementById('totalPremium').innerText = primeFinal.toFixed(2);


        // Résultat final
        document.getElementById("resultat").innerHTML = `

            <p>Poids corrigé: ${poidsCorrige} kg</p>
            <p>RPT: ${rpt}</p>
            <p>Surmortalité: ${indiceSurmortalite}%</p>
            <p>Garantie Décès : ${garantieDeces.toFixed(2)} Fcfa</p>
            <p>Taux Surprime : ${(tauxSurprime * 100).toFixed(2)} %</p>
            <p>Prime totale : ${prime.toFixed(2)} Fcfa</p>
        `;
    });
</script> --}}
    

